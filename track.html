<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Track Order </title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@300;400;500;600;700&family=Fredoka:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Navigation CSS -->
    <link rel="stylesheet" href="navigation.css">
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* ==================== MOBILE TOUCH FIXES ==================== */
        /* Allow tap highlights for better mobile feedback */
        button {
            -webkit-tap-highlight-color: rgba(99, 102, 241, 0.3);
        }
        
        html, body {
            touch-action: manipulation;
            overflow-x: hidden;
        }
        
        button, input, textarea {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 0;
            outline: none;
        }
        
        /* Allow text selection in inputs */
        input, textarea {
            -webkit-user-select: text !important;
            user-select: text !important;
        }
        
        /* Fix for iOS Safari */
        @supports (-webkit-touch-callout: none) {
            .mobile-menu {
                height: -webkit-fill-available;
            }
            
            input {
                font-size: 16px !important;
            }
        }
        
        /* Active state for touch */
        .touch-active {
            transform: scale(0.95) !important;
            transition: transform 0.1s !important;
            opacity: 0.8 !important;
        }
        
        /* Fix touch delays on mobile */
        @media (hover: none) and (pointer: coarse) {
            button, .btn-3d, .action-button, .nav-item, .mobile-nav-item {
                cursor: pointer;
            }
        }
        
        /* ==================== LOADING ANIMATION ==================== */
        .searching-animation {
            display: none;
            text-align: center;
            padding: 3rem 2rem;
        }
        
        .searching-animation.active {
            display: block;
        }
        
        .search-loader {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            position: relative;
        }
        
        .search-loader::before {
            content: 'üîç';
            position: absolute;
            font-size: 3rem;
            animation: searchRotate 2s linear infinite;
        }
        
        @keyframes searchRotate {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .search-dots {
            font-size: 1.2rem;
            color: var(--primary);
            letter-spacing: 2px;
        }
        
        .search-dots::after {
            content: '...';
            animation: dots 1.5s steps(4) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* ==================== SUCCESS POPUP ==================== */
        .success-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        }
        
        .success-popup.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .success-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.98), rgba(15, 23, 42, 0.98));
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            text-align: center;
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8) translateY(20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #10b981, #34d399);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            animation: successPulse 1s ease-in-out;
        }
        
        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .popup-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            color: #ef4444;
            font-size: 1.2rem;
        }

        /* ==================== ACTION BUTTONS ==================== */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .action-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            -webkit-tap-highlight-color: rgba(99, 102, 241, 0.2);
            touch-action: manipulation;
            flex: 1;
            min-width: 140px;
            justify-content: center;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .action-button:active {
            transform: scale(0.95);
            background: rgba(99, 102, 241, 0.2);
        }
        
        .action-button.copied {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            color: #10b981;
        }
        
        .action-button.pasted {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* ==================== ORDER RESULT CARD ==================== */
        .order-result-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .order-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .order-details {
            display: grid;
            gap: 1rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .detail-label {
            opacity: 0.7;
        }
        
        .detail-value {
            font-weight: 600;
            text-align: right;
        }

        /* ==================== FORM STYLES ==================== */
        .track-form-container {
            max-width: 600px;
            margin: 0 auto 3rem;
        }
        
        .input-with-button {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .input-with-button input {
            flex: 1;
            padding: 15px;
            font-size: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .input-with-button input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }
        
        /* ==================== MOBILE RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
            }
            
            .action-button {
                width: 100%;
                min-width: auto;
                padding: 15px;
            }
            
            .detail-row {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .detail-label, .detail-value {
                text-align: left;
                width: 100%;
            }
            
            .order-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .input-with-button {
                flex-direction: column;
            }
            
            .input-with-button button {
                width: 100%;
            }
            
            /* Make track button bigger on mobile */
            .track-button {
                padding: 18px !important;
                font-size: 1.2rem !important;
                margin-top: 20px !important;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .input-with-button input {
                padding: 12px;
            }
        }
        
        /* ==================== TRACK BUTTON ==================== */
        .track-button {
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 1.5rem;
            -webkit-tap-highlight-color: rgba(99, 102, 241, 0.3);
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .track-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(99, 102, 241, 0.4);
        }
        
        @media (hover: hover) {
            .track-button:hover {
                box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
            }
        }
    </style>
</head>
<body>
    <canvas id="particle-canvas"></canvas>

    <!-- Success Popup -->
    <div class="success-popup" id="successPopup">
        <div class="success-content">
            <div class="popup-close" onclick="closeSuccessPopup()">
                <i class="fas fa-times"></i>
            </div>
            <div class="success-icon">‚úì</div>
            <h2 style="color: #10b981; margin-bottom: 1rem; font-size: 1.8rem;">
                ‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑Ñ‡∂∏‡∑î ‡∑Ä‡∑í‡∂∫!
            </h2>
            <p style="opacity: 0.8; font-size: 1.1rem;">
                ‡∂î‡∂∂‡∑ö ‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∑É‡∑ú‡∂∫‡∑è ‡∂ú‡∂±‡∑ä‡∂±‡∑è ‡∂Ω‡∂Ø‡∑ì
            </p>
            <button class="action-button" onclick="closeSuccessPopup()" style="margin-top: 1.5rem;">
                <i class="fas fa-check"></i> ‡∑Ñ‡∂ª‡∑í
            </button>
        </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- Navigation -->
    <nav>
        <!-- Logo on Left -->
        <div class="nav-logo" data-action="go-home">
            <span class="flower-icon" style="font-size: 1.8rem;">üå∫</span>
            <span style="font-family: 'Noto Sans Sinhala', sans-serif;">‡∑É‡∂≠‡∑ä‡∑É‡∂ª ‡∂∏‡∂Ω‡∑ä ‡∂¥‡∑ê‡∑Ö</span>
        </div>
        
        <!-- Desktop Navigation -->
        <div class="nav-links">
            <div class="nav-item" data-page="home">
                <i class="fas fa-home"></i> Home
            </div>
            <div class="nav-item active" data-page="track">
                <i class="fas fa-search-location"></i> Track Order
            </div>
            <div class="nav-item" data-page="contact">
                <i class="fas fa-phone"></i> Contact
            </div>
            <div class="nav-item" data-page="faq">
                <i class="fas fa-question-circle"></i> FAQ
            </div>
            <div class="nav-item" data-page="about">
                <i class="fas fa-info-circle"></i> About
            </div>
        </div>
        
        <!-- Hamburger Menu on Right -->
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <h2>üõçÔ∏è SANJU STORE</h2>
            <p>Track Your Orders</p>
        </div>
        
        <div class="mobile-nav-items">
            <div class="mobile-nav-item" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="mobile-nav-item active" data-page="track">
                <i class="fas fa-search-location"></i>
                <span>Track Order</span>
            </div>
            <div class="mobile-nav-item" data-page="contact">
                <i class="fas fa-phone"></i>
                <span>Contact Us</span>
            </div>
            <div class="mobile-nav-item" data-page="faq">
                <i class="fas fa-question-circle"></i>
                <span>FAQ</span>
            </div>
            <div class="mobile-nav-item" data-page="about">
                <i class="fas fa-info-circle"></i>
                <span>About Us</span>
            </div>
            <div class="mobile-nav-item" data-page="privacy">
                <i class="fas fa-shield-alt"></i>
                <span>Privacy Policy</span>
            </div>
        </div>
        
        <div class="mobile-menu-footer">
            <div class="mobile-social-links">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-whatsapp"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
            </div>
            <p style="text-align: center; font-size: 0.85rem; color: rgba(255,255,255,0.5);">
                ¬© 2026 ‡∑É‡∂≠‡∑ä‡∑É‡∂ª ‡∂∏‡∂Ω‡∑ä ‡∂¥‡∑ê‡∑Ö
            </p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±</h1>
            <p class="hero-subtitle">‡∂î‡∂∂‡∑ö tracking ID ‡∂ë‡∂ö ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª ‡∂á‡∂´‡∑Ä‡∑î‡∂∏‡∑ö ‡∂≠‡∂≠‡∑ä‡∑Ä‡∂∫ ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±</p>
        </div>

        <!-- Track Form -->
        <div class="card-3d track-form-container">
            <form id="trackForm">
                <div class="form-group">
                    <label style="font-size: 1.1rem; margin-bottom: 10px; display: block;">
                        <i class="fas fa-barcode"></i> Tracking ID
                    </label>
                    
                    <div class="input-with-button">
                        <input type="text" 
                               id="trackingId" 
                               required 
                               placeholder="SFP-183796-543"
                               class="mono"
                               autocomplete="off"
                               autocorrect="off"
                               autocapitalize="none"
                               spellcheck="false">
                        <button type="button" class="action-button" id="pasteButton">
                            <i class="fas fa-paste"></i> Paste
                        </button>
                    </div>
                    
                    <small style="opacity: 0.6; font-size: 0.85rem; display: block; margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> 
                        ‡∂á‡∂´‡∑Ä‡∑î‡∂∏‡∑ä ‡∂ö‡∑Ö ‡∂¥‡∑É‡∑î ‡∂î‡∂∂‡∂ß ‡∂Ω‡∑ê‡∂∂‡∑î‡∂´‡∑î tracking ID ‡∂ë‡∂ö ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </small>
                    
                    <!-- Action Buttons -->
                    <div class="action-buttons" style="margin-top: 20px;">
                        <button type="button" class="action-button" onclick="clearTrackingId()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
                
                <!-- Track Button (Mobile Optimized) -->
                <button type="submit" class="track-button" id="trackButton">
                    <i class="fas fa-search"></i> ‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±
                </button>
            </form>
        </div>

        <!-- Searching Animation -->
        <div class="searching-animation" id="searchingAnimation">
            <div class="search-loader"></div>
            <h3 style="margin-bottom: 10px; font-size: 1.3rem;">‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑É‡∑ú‡∂∫‡∂∏‡∑í‡∂±‡∑ä</h3>
            <p class="search-dots">‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ª‡∑ê‡∂≥‡∑ì ‡∑É‡∑í‡∂ß‡∑í‡∂±‡∑ä‡∂±</p>
        </div>

        <!-- Order Result -->
        <div id="orderResult"></div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"></div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>‡∑É‡∂≠‡∑ä‡∑É‡∂ª ‡∂∏‡∂Ω‡∑ä ‡∂¥‡∑ê‡∑Ö</h3>
                <p>Your destination for next-generation shopping experiences. We bring products to life with cutting-edge technology.</p>
                <div class="social-links">
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <div class="footer-links">
                    <a href="index.html">Home</a>
                    <a href="track.html">Track Order</a>
                    <a href="about.html">About Us</a>
                    <a href="contact.html">Contact</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Customer Service</h3>
                <div class="footer-links">
                    <a href="#">Shipping Info</a>
                    <a href="#">Returns</a>
                    <a href="faq.html">FAQ</a>
                    <a href="#">Privacy Policy</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><i class="fas fa-envelope"></i> info@sanjustore.com</p>
                <p><i class="fas fa-phone"></i> +94 77 123 4567</p>
                <p><i class="fas fa-clock"></i> Available 24/7</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p class="footer-text">
                <span class="copyright">¬© 2026 <span class="brand">‡∑É‡∂≠‡∑ä‡∑É‡∂ª ‡∂∏‡∂Ω‡∑ä ‡∂¥‡∑ê‡∑Ö</span>. All rights reserved.</span>
                <span class="made-with">Made with <span class="heart">‚ù§Ô∏è</span> in <span class="brand">SADEEPA</span></span>
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="background.js"></script>
    <script src="navigation.js" defer></script>
    
    <script>
        // ======================
        // SUPABASE CONNECTION
        // ======================
        
        // Supabase is already initialized in config.js
        // Just check if it's available
        function checkSupabase() {
            if (window.supabaseClient) {
                console.log('‚úÖ Using Supabase from config.js');
                return true;
            } else {
                console.warn('‚ö†Ô∏è Supabase not available - using demo mode');
                return false;
            }
        }
        
        // ======================
        // MOBILE TOUCH FIXES - SIMPLIFIED
        // ======================
        
        // Just add visual feedback, no preventDefault
        if ('ontouchstart' in window) {
            const addTouchFeedback = (selector) => {
                document.addEventListener('touchstart', function(e) {
                    if (e.target.closest(selector)) {
                        e.target.closest(selector).classList.add('touch-active');
                    }
                }, { passive: true });
                
                document.addEventListener('touchend', function(e) {
                    if (e.target.closest(selector)) {
                        e.target.closest(selector).classList.remove('touch-active');
                    }
                }, { passive: true });
                
                document.addEventListener('touchcancel', function(e) {
                    if (e.target.closest(selector)) {
                        e.target.closest(selector).classList.remove('touch-active');
                    }
                }, { passive: true });
            };
            
            addTouchFeedback('button');
            addTouchFeedback('.action-button');
            addTouchFeedback('.track-button');
        }

        // ======================
        // PASTE FUNCTIONALITY
        // ======================
        
        async function pasteTrackingId() {
            const input = document.getElementById('trackingId');
            const pasteButton = document.getElementById('pasteButton');
            
            try {
                const text = await navigator.clipboard.readText();
                if (text.trim()) {
                    input.value = text.trim();
                    input.focus();
                    
                    // Visual feedback
                    const originalHTML = pasteButton.innerHTML;
                    pasteButton.innerHTML = '<i class="fas fa-check"></i> Pasted!';
                    pasteButton.classList.add('pasted');
                    
                    showToast('Tracking ID pasted! üìã', 'success');
                    
                    setTimeout(() => {
                        pasteButton.innerHTML = originalHTML;
                        pasteButton.classList.remove('pasted');
                    }, 1500);
                } else {
                    showToast('Clipboard is empty', 'info');
                }
            } catch (error) {
                console.log('Clipboard read failed:', error);
                showToast('Please paste manually (Ctrl+V)', 'info');
                input.focus();
            }
        }
        
        function clearTrackingId() {
            const input = document.getElementById('trackingId');
            input.value = '';
            input.focus();
            showToast('Cleared! ‚ú®', 'info');
        }

        // ======================
        // SUCCESS POPUP
        // ======================
        
        function showSuccessPopup() {
            document.getElementById('successPopup').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeSuccessPopup() {
            document.getElementById('successPopup').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ======================
        // COPY FUNCTION
        // ======================
        
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                button.classList.add('copied');
                
                showToast('Tracking ID copied! ‚úÖ', 'success');
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('copied');
                }, 1500);
            }).catch(err => {
                console.error('Copy failed:', err);
                showToast('Copy failed', 'error');
            });
        }

        // ======================
        // TOAST NOTIFICATION
        // ======================
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            if (!toast) return;
            
            toast.textContent = message;
            toast.className = 'show';
            
            if (type === 'success') {
                toast.style.borderColor = '#10b981';
                toast.style.background = 'rgba(16, 185, 129, 0.2)';
            } else if (type === 'error') {
                toast.style.borderColor = '#ef4444';
                toast.style.background = 'rgba(239, 68, 68, 0.2)';
            }
            
            setTimeout(() => {
                toast.className = '';
            }, 2500);
        }

        // ======================
        // TRACK ORDER FUNCTION - DATABASE INTEGRATED
        // ======================
        
        async function handleTrackOrder(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const trackingId = document.getElementById('trackingId').value.trim();
            const resultDiv = document.getElementById('orderResult');
            const searchingAnimation = document.getElementById('searchingAnimation');
            
            if (!trackingId) {
                showToast('Please enter a tracking ID', 'error');
                document.getElementById('trackingId').focus();
                return;
            }
            
            // Show searching animation
            resultDiv.innerHTML = '';
            searchingAnimation.classList.add('active');
            
            try {
                console.log('üîç Searching for order:', trackingId);
                
                // Database ‡∂ë‡∂ö‡∑ô‡∂±‡∑ä data ‡∂ú‡∂±‡∑ä‡∂±
                if (window.supabaseClient) {
                    const { data, error } = await window.supabaseClient
                        .from('orders')
                        .select('*')
                        .eq('tracking_id', trackingId)
                        .single();
                    
                    searchingAnimation.classList.remove('active');
                    
                    if (error || !data) {
                        console.log('‚ùå Order not found in database');
                        showOrderNotFound();
                        return;
                    }
                    
                    // ‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑Ñ‡∂∏‡∑î ‡∑Ä‡∑í‡∂∫!
                    console.log('‚úÖ Order found:', data);
                    showSuccessPopup();
                    displayOrder(data);
                    
                } else {
                    // Supabase ‡∂±‡∑ê‡∂≠‡∑ä‡∂±‡∂∏‡∑ä error ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
                    searchingAnimation.classList.remove('active');
                    showOrderNotFound();
                }
                
            } catch (error) {
                searchingAnimation.classList.remove('active');
                console.error('‚ùå Tracking error:', error);
                showOrderNotFound();
            }
        }
        
        // ======================
        // ORDER NOT FOUND MESSAGE
        // ======================
        
        function showOrderNotFound() {
            const resultDiv = document.getElementById('orderResult');
            
            resultDiv.innerHTML = `
                <div class="card-3d" style="text-align: center; padding: 3rem 2rem; max-width: 600px; margin: 0 auto;">
                    <span style="font-size: 4rem; display: block; margin-bottom: 1rem;">üòû</span>
                    <h3 style="color: var(--danger); margin-bottom: 1rem; font-size: 1.5rem;">
                        ‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑É‡∑ú‡∂∫‡∑è‡∂ú‡∂≠ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö‡∑í ‡∑Ä‡∑í‡∂∫
                    </h3>
                    <p style="opacity: 0.8; margin-bottom: 0.5rem;">
                        ‡∂î‡∂∂ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑Ö tracking ID ‡∂ë‡∂ö ‡∂Ö‡∂¥‡∂ú‡∑ö database ‡∂ë‡∂ö‡∑ö ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠
                    </p>
                    <p style="opacity: 0.6; margin-bottom: 1.5rem; font-size: 0.9rem;">
                        Tracking ID ‡∂ë‡∂ö ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∂Ø ‡∂∫‡∂±‡∑ä‡∂± ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </p>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="action-button" onclick="document.getElementById('trackingId').focus()">
                            <i class="fas fa-redo"></i> ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                        </button>
                        <button class="action-button" onclick="window.location.href='contact.html'">
                            <i class="fas fa-phone"></i> ‡∂Ö‡∂¥‡∑Ä ‡∂Ö‡∂∏‡∂≠‡∂±‡∑ä‡∂±
                        </button>
                    </div>
                </div>
            `;
            
            showToast('‚ùå ‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∑É‡∑ú‡∂∫‡∑è‡∂ú‡∂≠ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö‡∑í ‡∑Ä‡∑í‡∂∫', 'error');
            
            // Scroll to error message
            setTimeout(() => {
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // ======================
        // DISPLAY ORDER DETAILS
        // ======================
        
        function displayOrder(order) {
            const resultDiv = document.getElementById('orderResult');
            
            const statusColors = {
                'Pending': { bg: 'rgba(245, 158, 11, 0.2)', border: '#f59e0b', text: '#fbbf24' },
                'Confirmed': { bg: 'rgba(16, 185, 129, 0.2)', border: '#10b981', text: '#34d399' },
                'Cancelled': { bg: 'rgba(239, 68, 68, 0.2)', border: '#ef4444', text: '#f87171' }
            };
            
            const statusStyle = statusColors[order.status] || statusColors['Pending'];
            const orderDate = new Date(order.created_at).toLocaleDateString('si-LK', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            resultDiv.innerHTML = `
                <div class="order-result-card">
                    <div class="order-header">
                        <h2 style="color: var(--primary); font-size: 1.5rem; margin: 0;">
                            <i class="fas fa-box"></i> ‡∂á‡∂´‡∑Ä‡∑î‡∂∏‡∑ä ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª
                        </h2>
                        <div style="padding: 8px 16px; background: ${statusStyle.bg}; border: 1px solid ${statusStyle.border}; border-radius: 20px; color: ${statusStyle.text}; font-weight: 600;">
                            ${order.status}
                        </div>
                    </div>
                    
                    <div class="order-id">
                        <i class="fas fa-barcode"></i>
                        <span>${order.tracking_id}</span>
                        <div class="action-buttons">
                            <button class="action-button" onclick="copyToClipboard('${order.tracking_id}', this)">
                                <i class="fas fa-copy"></i> Copy ID
                            </button>
                            <button class="action-button" onclick="window.open('https://wa.me/94772254513?text=Tracking ID: ${order.tracking_id}', '_blank')">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                        </div>
                    </div>
                    
                    <div class="order-details">
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-user"></i> ‡∂ú‡∂±‡∑î‡∂Ø‡∑ô‡∂±‡∑î‡∂ö‡∂ª‡∑î‡∂ú‡∑ö ‡∂±‡∂∏</span>
                            <span class="detail-value">${order.customer_name}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-phone"></i> ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫</span>
                            <span class="detail-value mono">${order.phone_number || 'N/A'}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-map-marker-alt"></i> ‡∂Ω‡∑í‡∂¥‡∑í‡∂±‡∂∫</span>
                            <span class="detail-value">${order.address || 'N/A'}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-box-open"></i> ‡∂∑‡∑è‡∂´‡∂©‡∂∫</span>
                            <span class="detail-value">${order.product_name}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-sort-numeric-up"></i> ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫</span>
                            <span class="detail-value">${order.quantity || 1}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-money-bill-wave"></i> ‡∂∏‡∑î‡∑Ö‡∑î ‡∂∏‡∑î‡∂Ø‡∂Ω</span>
                            <span class="detail-value mono" style="color: var(--success); font-size: 1.2rem; font-weight: 700;">
                                Rs. ${order.total ? order.total.toLocaleString() : order.price.toLocaleString()}
                            </span>
                        </div>
                        
                        ${order.requirements ? `
                        <div class="detail-row" style="flex-direction: column; align-items: start; text-align: left;">
                            <span class="detail-label" style="margin-bottom: 8px;"><i class="fas fa-clipboard-list"></i> ‡∑Ä‡∑í‡∑Å‡∑ö‡∑Ç ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂≠‡∑è</span>
                            <span class="detail-value" style="opacity: 0.9; line-height: 1.6; text-align: left;">${order.requirements}</span>
                        </div>
                        ` : ''}
                        
                        <div class="detail-row">
                            <span class="detail-label"><i class="fas fa-calendar-alt"></i> ‡∂á‡∂´‡∑Ä‡∑î‡∂∏‡∑ä ‡∂Ø‡∑í‡∂±‡∂∫</span>
                            <span class="detail-value">${orderDate}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1); text-align: center;">
                        <p style="opacity: 0.7; margin-bottom: 1rem;">
                            <i class="fas fa-info-circle"></i> 
                            ‡∑Ä‡∑ê‡∂©‡∑í‡∂Ø‡∑î‡∂ª ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂Ö‡∂¥ ‡∂Ö‡∂∏‡∂≠‡∂±‡∑ä‡∂±
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="action-button" onclick="window.location.href='contact.html'">
                                <i class="fas fa-phone"></i> ‡∂Ö‡∂¥‡∑Ä ‡∂Ö‡∂∏‡∂≠‡∂±‡∑ä‡∂±
                            </button>
                            <button class="action-button" onclick="window.location.href='index.html'">
                                <i class="fas fa-shopping-cart"></i> ‡∂≠‡∑Ä‡∂≠‡∑ä ‡∂á‡∂´‡∑Ä‡∑î‡∂∏‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Scroll to result
            setTimeout(() => {
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }
        
        // ======================
        // INITIALIZATION
        // ======================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check Supabase availability
            checkSupabase();
            
            // Form submission
            const trackForm = document.getElementById('trackForm');
            if (trackForm) {
                trackForm.addEventListener('submit', handleTrackOrder);
            }
            
            // Paste button
            const pasteButton = document.getElementById('pasteButton');
            if (pasteButton) {
                pasteButton.addEventListener('click', pasteTrackingId);
            }
            
            // Enter key to submit
            const trackingInput = document.getElementById('trackingId');
            if (trackingInput) {
                trackingInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleTrackOrder(e);
                    }
                });
                
                // Auto-focus on page load
                setTimeout(() => {
                    trackingInput.focus();
                }, 500);
            }
        });
        
        // Fix viewport for mobile
        function setVH() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        window.addEventListener('load', setVH);
        window.addEventListener('resize', setVH);
        
    </script>
</body>
</html>
