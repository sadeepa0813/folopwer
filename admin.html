<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - 3D Store</title>
    
    <!-- ... existing head content ... -->
    
    <style>
        /* ... existing styles ... */
        
        /* Mobile Hamburger Menu */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 1001;
        }
        
        .hamburger-menu span {
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        
        .hamburger-menu.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .hamburger-menu.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger-menu.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        .mobile-nav-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .mobile-nav-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .mobile-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(16, 185, 129, 0.3);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }
        
        .mobile-nav.active {
            transform: translateX(0);
        }
        
        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mobile-nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .mobile-nav-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .mobile-nav-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        .mobile-nav-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .mobile-nav-item {
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .mobile-nav-item:hover {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary);
            transform: translateX(5px);
        }
        
        .mobile-nav-item.active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(52, 211, 153, 0.1));
            color: var(--primary);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .mobile-nav-item i {
            width: 20px;
            text-align: center;
        }
        
        .mobile-nav-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 768px) {
            .hamburger-menu {
                display: flex;
            }
            
            .nav-links {
                display: none;
            }
            
            nav {
                padding: 15px 20px;
            }
            
            .nav-logo span:nth-child(2) {
                font-size: 1.1rem;
            }
        }
        
        /* Bulk Action Improvements */
        .bulk-action-container {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            background: rgba(16, 185, 129, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(16, 185, 129, 0.2);
            margin-bottom: 20px;
        }
        
        .bulk-select-all {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
        }
        
        .bulk-select-all:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .bulk-select-all input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        /* Order Row Selection */
        tr.selected-order {
            background: rgba(16, 185, 129, 0.1) !important;
            border-left: 3px solid var(--primary) !important;
        }
        
        tr.selected-order:hover td {
            background: rgba(16, 185, 129, 0.15) !important;
        }
        
        /* Quick Confirm Buttons */
        .quick-confirm-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            z-index: 100;
            transition: all 0.3s;
        }
        
        .quick-confirm-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(16, 185, 129, 0.5);
        }
        
        @media (max-width: 768px) {
            .quick-confirm-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Particle Background Canvas -->
    <canvas id="particle-canvas"></canvas>

    <!-- Navigation -->
    <nav>
        <div class="nav-logo">
            <span>‚öôÔ∏è</span>
            <span>ADMIN DASHBOARD</span>
        </div>
        
        <!-- Desktop Navigation -->
        <div class="nav-links">
            <div class="nav-item active" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> <span class="nav-text">Dashboard</span>
            </div>
            <div class="nav-item" onclick="showSection('products')">
                <i class="fas fa-box"></i> <span class="nav-text">Products</span>
            </div>
            <div class="nav-item" onclick="showSection('orders')">
                <i class="fas fa-shopping-cart"></i> <span class="nav-text">Orders</span>
                <span id="pendingBadge" class="today-badge" style="display: none;">0</span>
            </div>
            <div class="nav-item" onclick="showSection('customers')">
                <i class="fas fa-users"></i> <span class="nav-text">Customers</span>
            </div>
            <button class="btn-3d btn-danger btn-small" onclick="handleLogout()">
                <i class="fas fa-sign-out-alt"></i> <span class="logout-text">Logout</span>
            </button>
        </div>
        
        <!-- Mobile Hamburger Menu -->
        <button class="hamburger-menu" onclick="toggleMobileMenu()">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </nav>

    <!-- Mobile Navigation Overlay -->
    <div class="mobile-nav-overlay" onclick="closeMobileMenu()"></div>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-nav">
        <div class="mobile-nav-header">
            <div class="mobile-nav-logo">
                <span>‚öôÔ∏è</span>
                <span>ADMIN PANEL</span>
            </div>
            <button class="mobile-nav-close" onclick="closeMobileMenu()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="mobile-nav-items">
            <div class="mobile-nav-item active" onclick="showSection('dashboard'); closeMobileMenu();">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="mobile-nav-item" onclick="showSection('products'); closeMobileMenu();">
                <i class="fas fa-box"></i> Products
            </div>
            <div class="mobile-nav-item" onclick="showSection('orders'); closeMobileMenu();">
                <i class="fas fa-shopping-cart"></i> Orders
                <span id="mobilePendingBadge" class="today-badge" style="margin-left: auto; display: none;">0</span>
            </div>
            <div class="mobile-nav-item" onclick="showSection('customers'); closeMobileMenu();">
                <i class="fas fa-users"></i> Customers
            </div>
        </div>
        
        <div class="mobile-nav-footer">
            <button class="btn-3d btn-danger" onclick="handleLogout()" style="width: 100%;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Orders Section -->
        <div id="orders" class="admin-section">
            <h2 class="mb-3" style="color: var(--primary);">
                <i class="fas fa-shopping-cart"></i> Order Management
            </h2>
            
            <!-- Bulk Actions Container -->
            <div class="bulk-action-container">
                <div class="bulk-select-all" onclick="toggleSelectAll()">
                    <input type="checkbox" id="selectAllCheckbox">
                    <span>Select All</span>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; flex: 1; flex-wrap: wrap;">
                    <select id="bulkAction" class="form-control" style="flex: 1; min-width: 200px;">
                        <option value="">‚ö° Bulk Action</option>
                        <option value="confirm">‚úÖ Confirm Selected Orders</option>
                        <option value="cancel">‚ùå Cancel Selected Orders</option>
                    </select>
                    <button class="btn-3d btn-primary" onclick="applyBulkAction()" style="min-width: 120px;">
                        <i class="fas fa-play"></i> Apply
                    </button>
                    <span id="selectedCount" style="opacity: 0.8; margin-left: 10px; font-weight: 500;">
                        <i class="fas fa-check-square"></i> 0 orders selected
                    </span>
                    <button class="btn-3d btn-secondary btn-small" onclick="clearSelection()" style="margin-left: auto;">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
            </div>
            
            <!-- Quick Confirm Button (for mobile) -->
            <button class="quick-confirm-btn" onclick="quickConfirmAll()" title="Confirm All Selected" id="quickConfirmBtn" style="display: none;">
                <i class="fas fa-check"></i>
            </button>
            
            <!-- ... rest of the orders section ... -->
        </div>
    </div>

    <!-- Script for Mobile Menu and Bulk Actions -->
    <script>
        // Mobile Menu Functions
        function toggleMobileMenu() {
            const hamburger = document.querySelector('.hamburger-menu');
            const mobileNav = document.querySelector('.mobile-nav');
            const overlay = document.querySelector('.mobile-nav-overlay');
            
            hamburger.classList.toggle('active');
            mobileNav.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // Toggle body scroll
            document.body.style.overflow = hamburger.classList.contains('active') ? 'hidden' : '';
        }
        
        function closeMobileMenu() {
            const hamburger = document.querySelector('.hamburger-menu');
            const mobileNav = document.querySelector('.mobile-nav');
            const overlay = document.querySelector('.mobile-nav-overlay');
            
            hamburger.classList.remove('active');
            mobileNav.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // Update mobile navigation when changing sections
        function showSection(sectionId) {
            // Close mobile menu if open
            closeMobileMenu();
            
            // ... existing showSection code ...
            
            // Update mobile nav items
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const sectionMap = {
                'dashboard': 0,
                'products': 1,
                'orders': 2,
                'customers': 3
            };
            
            if (sectionMap[sectionId] !== undefined) {
                document.querySelectorAll('.mobile-nav-item')[sectionMap[sectionId]].classList.add('active');
            }
        }
        
        // Bulk Action Functions
        function toggleSelectAll() {
            const checkbox = document.getElementById('selectAllCheckbox');
            const isChecked = !checkbox.checked;
            checkbox.checked = isChecked;
            
            // Clear current selection
            selectedOrders.clear();
            
            // Add or remove all filtered orders
            let filteredOrders = allOrders;
            if (currentFilter === 'today') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                filteredOrders = allOrders.filter(o => new Date(o.created_at) >= today);
            } else if (currentFilter === 'this_week') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredOrders = allOrders.filter(o => new Date(o.created_at) >= weekAgo);
            } else if (currentFilter !== 'all') {
                filteredOrders = allOrders.filter(o => o.status === currentFilter);
            }
            
            if (isChecked) {
                filteredOrders.forEach(order => {
                    selectedOrders.add(order.tracking_id);
                });
            }
            
            updateSelectedCount();
            displayOrders(allOrders);
            
            // Show/hide quick confirm button
            const quickConfirmBtn = document.getElementById('quickConfirmBtn');
            if (quickConfirmBtn) {
                quickConfirmBtn.style.display = selectedOrders.size > 0 ? 'flex' : 'none';
            }
        }
        
        function clearSelection() {
            selectedOrders.clear();
            updateSelectedCount();
            displayOrders(allOrders);
            
            // Uncheck select all checkbox
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
            }
            
            // Hide quick confirm button
            const quickConfirmBtn = document.getElementById('quickConfirmBtn');
            if (quickConfirmBtn) {
                quickConfirmBtn.style.display = 'none';
            }
            
            showToast('Selection cleared', 'info');
        }
        
        function quickConfirmAll() {
            if (selectedOrders.size === 0) {
                showToast('No orders selected', 'warning');
                return;
            }
            
            if (confirm(`Confirm ${selectedOrders.size} selected order(s)?`)) {
                // Set bulk action to confirm and apply
                document.getElementById('bulkAction').value = 'confirm';
                applyBulkAction();
            }
        }
        
        // Update displayOrders to show selected rows
        function displayOrders(orders) {
            let filteredOrders = orders;
            
            // Apply filter
            if (currentFilter === 'today') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                filteredOrders = orders.filter(o => new Date(o.created_at) >= today);
            } else if (currentFilter === 'this_week') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredOrders = orders.filter(o => new Date(o.created_at) >= weekAgo);
            } else if (currentFilter !== 'all') {
                filteredOrders = orders.filter(o => o.status === currentFilter);
            }
            
            const container = document.getElementById('ordersTableContainer');
            
            if (!filteredOrders || filteredOrders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <div class="empty-state-title">No Orders Found</div>
                        <div class="empty-state-message">
                            ${currentFilter === 'today' ? 'No orders placed today' : 
                              currentFilter === 'this_week' ? 'No orders this week' : 
                              'No orders to display'}
                        </div>
                    </div>
                `;
                return;
            }
            
            const html = filteredOrders.map(order => {
                const isSelected = selectedOrders.has(order.tracking_id);
                return `
                    <tr class="${isSelected ? 'selected-order' : ''}" onclick="handleOrderRowClick('${order.tracking_id}', event)">
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" 
                                       ${isSelected ? 'checked' : ''}
                                       onclick="toggleOrderSelection('${order.tracking_id}'); event.stopPropagation()"
                                       style="width: 18px; height: 18px; cursor: pointer;">
                                <div class="tracking-id" onclick="copyTrackingId('${order.tracking_id}', event)">
                                    <span class="mono" style="font-size: 0.9rem;">${order.tracking_id}</span>
                                    <button class="copy-btn" title="Copy Tracking ID">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </td>
                        <td>
                            <strong>${order.customer_name}</strong>
                            <div style="font-size: 0.85rem; opacity: 0.7; margin-top: 3px;">
                                ${order.address ? order.address.substring(0, 30) + '...' : 'No address'}
                            </div>
                        </td>
                        <td>
                            <a href="tel:${order.phone_number}" class="customer-phone-link" onclick="event.stopPropagation()">
                                <i class="fas fa-phone"></i> ${order.phone_number}
                            </a>
                        </td>
                        <td>
                            <strong>${order.product_name}</strong>
                            <div style="font-size: 0.85rem; opacity: 0.7; margin-top: 3px;">
                                Qty: ${order.quantity}
                            </div>
                        </td>
                        <td class="mono" style="font-weight: 700; color: var(--success);">
                            Rs. ${order.total.toLocaleString()}
                        </td>
                        <td>
                            <span class="status-badge status-${order.status.toLowerCase()}">
                                <i class="fas fa-${getStatusIcon(order.status)}"></i>
                                ${order.status}
                            </span>
                        </td>
                        <td style="font-size: 0.9rem; opacity: 0.8;">
                            ${new Date(order.created_at).toLocaleDateString('en-US', { 
                                month: 'short', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                            ${isToday(order.created_at) ? '<span class="today-badge">Today</span>' : ''}
                        </td>
                        <td>
                            <div class="order-actions">
                                <button class="order-action-btn view-btn" 
                                        onclick='viewOrderDetails(${JSON.stringify(order).replace(/'/g, "&#39;")})' 
                                        title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${order.status === 'Pending' ? `
                                    <button class="order-action-btn confirm-btn" 
                                            onclick="updateOrderStatus('${order.tracking_id}', 'Confirmed')"
                                            title="Confirm Order">
                                        <i class="fas fa-check"></i>
                                    </button>
                                ` : ''}
                                ${order.status !== 'Cancelled' ? `
                                    <button class="order-action-btn cancel-btn" 
                                            onclick="updateOrderStatus('${order.tracking_id}', 'Cancelled')"
                                            title="Cancel Order">
                                        <i class="fas fa-times"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            container.innerHTML = `
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 220px;">Selection & Tracking ID</th>
                                <th>Customer</th>
                                <th>Phone</th>
                                <th>Product</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>${html}</tbody>
                    </table>
                </div>
            `;
            
            // Update select all checkbox state
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = filteredOrders.length > 0 && 
                    filteredOrders.every(order => selectedOrders.has(order.tracking_id));
            }
            
            // Show/hide quick confirm button
            const quickConfirmBtn = document.getElementById('quickConfirmBtn');
            if (quickConfirmBtn) {
                quickConfirmBtn.style.display = selectedOrders.size > 0 ? 'flex' : 'none';
            }
        }
        
        // Initialize mobile menu update for pending orders
        function updatePendingBadge(count) {
            const desktopBadge = document.getElementById('pendingBadge');
            const mobileBadge = document.getElementById('mobilePendingBadge');
            
            if (desktopBadge) {
                desktopBadge.textContent = count;
                desktopBadge.style.display = count > 0 ? 'inline-block' : 'none';
            }
            
            if (mobileBadge) {
                mobileBadge.textContent = count;
                mobileBadge.style.display = count > 0 ? 'inline-block' : 'none';
            }
        }
        
        // Update loadDashboardStats to update both badges
        async function loadDashboardStats() {
            try {
                // ... existing code ...
                
                // Update pending badge with count
                updatePendingBadge(pendingRes.count || 0);
                
                // ... rest of the code ...
            } catch (error) {
                console.error('‚ùå Dashboard error:', error);
            }
        }
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileNav = document.querySelector('.mobile-nav');
            const hamburger = document.querySelector('.hamburger-menu');
            
            if (mobileNav.classList.contains('active') && 
                !mobileNav.contains(event.target) && 
                !hamburger.contains(event.target)) {
                closeMobileMenu();
            }
        });
        
        // Handle escape key to close mobile menu
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeMobileMenu();
            }
        });
    </script>
</body>
</html>
